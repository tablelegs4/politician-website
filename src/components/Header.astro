---
// ヘッダーコンポーネント（JSなし、details/summaryでSPメニュー実装）
import { THEME_IMAGES, getThemeFromUrl } from '../config/theme';

// URLパラメータからテーマを取得
const currentTheme = getThemeFromUrl(Astro.url);

// URLパラメータを保持する関数
const themeParam = Astro.url.searchParams.get('theme');
const themeQuery = themeParam ? `?theme=${themeParam}` : '';

// ベースパスを適用したパスを生成する関数
const baseUrl = import.meta.env.BASE_URL || '/';
const withBase = (path: string) => {
  if (path.startsWith('http://') || path.startsWith('https://') || path.startsWith('//') || path.startsWith('#')) {
    return path;
  }
  const base = baseUrl.endsWith('/') ? baseUrl.slice(0, -1) : baseUrl;
  const cleanPath = path.startsWith('/') ? path : `/${path}`;
  return `${base}${cleanPath}${themeQuery}`;
};

// ナビゲーション項目の定義
// isExternal: true の場合はページ遷移（遷移アイコン表示）
// PC用ナビ項目
const navItemsPC = [
  { label: 'トップ', href: '/', isExternal: false },
  { label: '魂のメッセージ', href: '#message', isExternal: false },
  { label: '政策', href: '#policy', isExternal: false },
  { label: '活動報告', href: '#activity', isExternal: false },
  { label: 'プロフィール', href: '/profile/', isExternal: true },
  { label: 'お問い合わせ', href: '/contact/', isExternal: true },
  { label: 'プライバシーポリシー', href: '/privacy/', isExternal: true },
];

// SP用ナビ項目（全てTOPページ内のアンカーリンク、ページ遷移なし）
const navItemsSP = [
  { label: 'トップ', href: '#top', isExternal: false },
  { label: '魂のメッセージ', href: '#message', isExternal: false },
  { label: '政策', href: '#policy', isExternal: false },
  { label: 'プロフィール', href: '#profile', isExternal: false },
  { label: '活動報告', href: '#activity', isExternal: false },
  { label: 'よくある質問', href: '#faq', isExternal: false },
  { label: '応援する', href: '#support', isExternal: false },
];

---

<header class="site-header sticky top-0 z-[100] py-5 md:py-5 max-md:py-[0.3rem] bg-gradient-to-b from-[#054a96] to-[#032f5e] text-white shadow-[inset_0_-3px_0_0_#f5b500,0_2px_4px_rgba(0,0,0,0.1)]">
  <div class="container max-w-full max-md:pl-[5px]">
    <div class="header-inner flex justify-between items-center relative">
      <div class="header-left flex items-center">
        <div class="site-title text-[0.5rem] font-bold text-white">
          <a href={withBase('/')} class="no-underline text-inherit flex items-center">
            <img src={THEME_IMAGES[currentTheme].logo} alt="山田太郎" class="header-logo" />
          </a>
        </div>
        <img src={withBase('/images/common/kokusa/kokusa_banzai.png')} alt="コクサ" class="header-kokusa" />
      </div>

      <!-- SP用ハンバーガーメニュー -->
      <details class="nav-toggle md:hidden cursor-pointer select-none relative order-10 ml-auto" id="sp-menu">
        <summary aria-label="メニューを開く" class="text-xl text-white p-1 [&::-webkit-details-marker]:hidden list-none">☰</summary>
        <nav class="main-nav-sp absolute top-full right-0 bg-[#032f5e] p-4 rounded min-w-[200px] shadow-[0_10px_15px_-3px_rgba(0,0,0,0.1),0_4px_6px_-2px_rgba(0,0,0,0.05)] z-[200]" aria-label="メインナビゲーション">
          <ul class="list-none flex flex-col gap-0">
            {navItemsSP.map((item) => (
              <li>
                <a href={withBase(item.href)} class={`block py-3 px-4 border-b border-white/20 text-white hover:bg-white/10 hover:no-underline last:border-b-0 ${item.isExternal ? 'inline-flex items-center' : ''}`}>
                  {item.label}
                  {item.isExternal && <span class="text-[0.75em] ml-1 opacity-80" aria-hidden="true">↗</span>}
                </a>
              </li>
            ))}
          </ul>
        </nav>
      </details>
      <!-- メニュー外タップで閉じる用オーバーレイ -->
      <div class="menu-overlay hidden fixed top-0 left-0 w-full h-full z-[99] [details[open]~&]:max-md:block" id="menu-overlay"></div>

      <!-- PC用ナビはCSSで常時表示 -->
      <nav class="main-nav-pc max-md:hidden ml-auto" aria-label="メインナビゲーション">
        <ul class="list-none flex items-center gap-10">
          {navItemsPC.map((item) => (
            <li>
              <a href={withBase(item.href)} class={`text-white font-medium text-[1.0625rem] py-2 border-b-2 border-transparent hover:border-white hover:no-underline transition-all duration-200 ${item.isExternal ? 'inline-flex items-center' : ''}`}>
                {item.label}
                {item.isExternal && <span class="text-[0.75em] ml-1 opacity-80" aria-hidden="true">↗</span>}
              </a>
            </li>
          ))}
        </ul>
      </nav>

    </div>
  </div>
</header>

<<<<<<< HEAD
=======
<style>
  /* ===========================
     ヘッダー（SP/PC差別化）
     =========================== */
  .site-header {
    background: linear-gradient(180deg, #054a96 0%, var(--color-primary-dark) 100%);
    color: #fff;
    padding: 1.25rem 0;
    position: -webkit-sticky;
    position: sticky;
    top: 0;
    z-index: var(--z-header);
    box-shadow: inset 0 -3px 0 0 var(--color-secondary), 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .site-header .container {
    max-width: 100%;
  }

  .header-inner {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  /* ヘッダー左側（ロゴ＋コクサ） */
  .header-left {
    display: flex;
    align-items: center;
  }

  .site-title {
    font-size: .5rem;
    font-weight: bold;
    color: #fff;
  }

  .site-title a {
    color: inherit;
    text-decoration: none;
    display: flex;
    align-items: center;
  }

  .header-logo {
    height: 60px;
    width: auto;
  }

  /* ヘッダーのコクサ画像（global.cssで共通化済み） */

  /* 外部リンクアイコン */
  .external-icon {
    font-size: 0.75em;
    margin-left: 0.25em;
    opacity: 0.8;
  }

  .nav-external {
    display: inline-flex;
    align-items: center;
  }

  /* メニュー外タップで閉じる用オーバーレイ */
  .menu-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: var(--z-overlay);
  }

  /* SP用スタイル */
  @media (max-width: 767px) {
    .site-header {
      padding: 0.3rem 0;
      overflow: visible;
      position: -webkit-sticky;
      position: sticky;
      top: 0;
    }
    .site-header .container {
      padding-left: 5px;
    }
    .header-logo {
      height: 65px;
    }
    .header-inner {
      position: relative;
    }
    .nav-toggle {
      order: 10;
      margin-left: auto;
    }
    .header-kokusa {
      z-index: var(--z-header-kokusa);
    }
    .nav-toggle[open] ~ .menu-overlay {
      display: block;
    }
  }

  /* SP: ハンバーガーメニュー（details/summary使用、JSなし） */
  @media (max-width: 767px) {
    /* SP: details外のPC用navを非表示 */
    .header-inner > .main-nav {
      display: none;
    }

    .nav-toggle {
      cursor: pointer;
      user-select: none;
      position: relative;
    }

    .nav-toggle summary {
      list-style: none;
      font-size: 1.25rem;
      color: #fff;
      padding: 0.25rem;
    }

    .nav-toggle summary::-webkit-details-marker {
      display: none;
    }

    .nav-toggle[open] summary {
      margin-bottom: 0;
    }

    /* ドロップダウンメニュー */
    .nav-toggle .main-nav {
      position: absolute;
      top: 100%;
      right: 0;
      background: var(--color-primary-dark);
      padding: var(--spacing-md);
      border-radius: var(--border-radius-sm);
      min-width: 200px;
      box-shadow: var(--shadow-lg);
      z-index: var(--z-modal);
    }

    .nav-toggle .main-nav ul {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .nav-toggle .main-nav a {
      color: #fff;
      display: block;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .nav-toggle .main-nav li:last-child a {
      border-bottom: none;
    }

    .nav-toggle .main-nav a:hover {
      background: rgba(255, 255, 255, 0.1);
      text-decoration: none;
    }
  }

  /* PC: 常時表示ナビ */
  @media (min-width: 768px) {
    /* PC: details（ハンバーガー）を非表示 */
    .nav-toggle {
      display: none;
    }

    /* PC: ナビを右端に配置 */
    .header-inner > .main-nav {
      margin-left: auto;
    }

    .main-nav ul {
      list-style: none;
      display: flex;
      align-items: center;
      gap: 2.5rem;
    }

    .main-nav a {
      color: #fff;
      font-weight: 500;
      font-size: 1.0625rem;
      padding: 0.5rem 0;
      border-bottom: 2px solid transparent;
      transition: border-color 0.2s;
    }

    .main-nav a:hover {
      border-bottom-color: #fff;
      text-decoration: none;
    }
  }

  /* iPhone SE (375px)専用 */
  @media (max-width: 375px) {
    .site-header {
      padding: 0.25rem 0;
    }

    .header-logo {
      height: 50px;
    }
  }
  }
</style>

>>>>>>> bdf00d5 (変更：モダンテーマのページとスタイルを削除し、デフォルトテーマに統一。テーマ設定を簡素化し、CSS変数を導入してスタイルの一貫性を向上。レスポンシブデザインの最適化を実施。)
<script>
  // メニュー外タップで閉じる
  document.addEventListener('DOMContentLoaded', () => {
    const menu = document.getElementById('sp-menu');
    const overlay = document.getElementById('menu-overlay');

    if (overlay && menu) {
      overlay.addEventListener('click', () => {
        menu.removeAttribute('open');
      });
    }

    // メニュー内のリンククリックでメニューを閉じる
    if (menu) {
      const links = menu.querySelectorAll('a');
      links.forEach(link => {
        link.addEventListener('click', () => {
          menu.removeAttribute('open');
        });
      });
    }
  });
</script>
