---
// デフォルトテーマのプロフィールページ（足立方式）
import { getProfile } from '../../../utils/content';

const profile = getProfile();

// アスタリスク囲みのテキストを強調表示に変換する関数
const formatWithEmphasis = (text: string) => {
  return text.replace(/\*([^*]+)\*/g, '<strong class="emphasis">$1</strong>');
};

// URLパラメータを保持する関数
const themeParam = Astro.url.searchParams.get('theme');
const themeQuery = themeParam ? `?theme=${themeParam}` : '';

// ベースパスを適用したパスを生成する関数
const baseUrl = import.meta.env.BASE_URL || '/';
const withBase = (path: string) => {
  if (path.startsWith('http://') || path.startsWith('https://') || path.startsWith('//')) {
    return path;
  }
  const base = baseUrl.endsWith('/') ? baseUrl.slice(0, -1) : baseUrl;
  const cleanPath = path.startsWith('/') ? path : `/${path}`;
  return `${base}${cleanPath}${themeQuery}`;
};

// 画像パスにベースを適用
const withImageBase = (path: string) => {
  if (path.startsWith('http://') || path.startsWith('https://') || path.startsWith('//')) {
    return path;
  }
  const base = baseUrl.endsWith('/') ? baseUrl.slice(0, -1) : baseUrl;
  const cleanPath = path.startsWith('/') ? path : `/${path}`;
  return `${base}${cleanPath}`;
};

// 経歴がセットされているか確認
const hasHistory = profile.history && profile.history.length > 0 && profile.history.some((h: any) => h.year || h.event);

// 実績がセットされているか確認
const hasAchievements = profile.achievements && profile.achievements.length > 0;
---

<main>
  <div class="container">
    <!-- プロフィールコンテンツ -->
    <div class="profile-content">
      <!-- プロフィールヘッダー：二つ名 + 名前 + 写真 + 選挙区 -->
      <section class="profile-header">
        <div class="profile-header-content">
          {profile.nickname && <p class="profile-nickname" set:html={formatWithEmphasis(profile.nickname)} />}
          <h2 class="profile-fullname">
            {profile.nameReading && <ruby>{profile.name}<rp>(</rp><rt>{profile.nameReading}</rt><rp>)</rp></ruby>}
            {!profile.nameReading && profile.name}
          </h2>
          <div class="profile-header-image-wrapper">
            <img
              src={withImageBase(profile.photo)}
              alt={`${profile.name}のプロフィール写真`}
              class="profile-main-image"
              loading="eager"
            />
          </div>
          {profile.basicInfo?.activityArea && (
            <p class="profile-district">{profile.basicInfo.activityArea}</p>
          )}
        </div>
      </section>

      <!-- 基本情報 -->
      <section class="mt-4">
        <h2 class="section-title-with-kokusa">
          <span>基本情報</span>
          <span class="section-kokusa-wrapper"><img src={withImageBase('/images/common/kokusa/kokusa_circle.png')} alt="" class="section-kokusa" /></span>
        </h2>
        <div class="profile-list profile-info-list">
          <div class="profile-info-item">
            <div class="profile-info-label">氏名</div>
            <div class="profile-info-value">{profile.name}{profile.nameReading && `（${profile.nameReading}）`}</div>
          </div>
          {profile.basicInfo?.activityArea && (
            <div class="profile-info-item">
              <div class="profile-info-label">活動地域</div>
              <div class="profile-info-value">{profile.basicInfo.activityArea}</div>
            </div>
          )}
          {profile.basicInfo?.birthYear && (
            <div class="profile-info-item">
              <div class="profile-info-label">生年</div>
              <div class="profile-info-value">{profile.basicInfo.birthYear}</div>
            </div>
          )}
          {profile.basicInfo?.currentAddress && (
            <div class="profile-info-item">
              <div class="profile-info-label">現住所</div>
              <div class="profile-info-value">{profile.basicInfo.currentAddress}</div>
            </div>
          )}
          {profile.basicInfo?.birthplace && (
            <div class="profile-info-item">
              <div class="profile-info-label">出身地</div>
              <div class="profile-info-value">{profile.basicInfo.birthplace}</div>
            </div>
          )}
          {profile.basicInfo?.education && (
            <div class="profile-info-item">
              <div class="profile-info-label">最終学歴</div>
              <div class="profile-info-value">{profile.basicInfo.education}</div>
            </div>
          )}
          {profile.basicInfo?.motto && (
            <div class="profile-info-item">
              <div class="profile-info-label">座右の銘</div>
              <div class="profile-info-value">{profile.basicInfo.motto}</div>
            </div>
          )}
          {profile.basicInfo?.respectedPerson && (
            <div class="profile-info-item">
              <div class="profile-info-label">尊敬する人物</div>
              <div class="profile-info-value">{profile.basicInfo.respectedPerson}</div>
            </div>
          )}
          {profile.basicInfo?.family && (
            <div class="profile-info-item">
              <div class="profile-info-label">家族構成</div>
              <div class="profile-info-value">{profile.basicInfo.family}</div>
            </div>
          )}
          {profile.basicInfo?.hobbies && (
            <div class="profile-info-item">
              <div class="profile-info-label">趣味</div>
              <div class="profile-info-value">{profile.basicInfo.hobbies}</div>
            </div>
          )}
          {profile.basicInfo?.petName && (
            <div class="profile-info-item">
              <div class="profile-info-label">愛犬の名前</div>
              <div class="profile-info-value">{profile.basicInfo.petName}</div>
            </div>
          )}
          {profile.basicInfo?.morningRoutine && (
            <div class="profile-info-item">
              <div class="profile-info-label">朝の日課</div>
              <div class="profile-info-value">{profile.basicInfo.morningRoutine}</div>
            </div>
          )}
        </div>
      </section>

      <!-- 経歴 -->
      {hasHistory && (
        <section class="mt-4">
          <h2 class="section-title-with-kokusa">
            <span>経歴</span>
            <span class="section-kokusa-wrapper"><img src={withImageBase('/images/common/kokusa/kokusa_gaze.png')} alt="" class="section-kokusa" /></span>
          </h2>
          <ul class="profile-list history-list">
            {profile.history.filter((h: any) => h.year || h.event).map((item: any) => (
              <li>
                {item.year && <span class="history-year">{item.year}</span>}
                {item.event}
              </li>
            ))}
          </ul>
        </section>
      )}

      <!-- 政治信条 -->
      {profile.politicalBelief && (
        <section class="mt-4">
          <h2 class="section-title-with-kokusa">
            <span>政治信条</span>
            <span class="section-kokusa-wrapper"><img src={withImageBase('/images/common/kokusa/kokusa_fistpump.png')} alt="" class="section-kokusa" /></span>
          </h2>
          <div class="political-belief">
            {typeof profile.politicalBelief === 'string' ? (
              <p>{profile.politicalBelief}</p>
            ) : (
              <>
                <p class="political-belief-title">{profile.politicalBelief.title}</p>
                <p class="political-belief-detail">{profile.politicalBelief.detail}</p>
              </>
            )}
          </div>
        </section>
      )}

      <!-- 実績 -->
      {hasAchievements && (
        <section class="mt-4">
          <h2 class="section-title-with-kokusa">
            <span>実績</span>
            <span class="section-kokusa-wrapper"><img src={withImageBase('/images/common/kokusa/kokusa_thumbsup.png')} alt="" class="section-kokusa" /></span>
          </h2>
          <ul class="profile-list achievements-list">
            {profile.achievements?.map((item: string) => (
              <li>{item}</li>
            ))}
          </ul>
        </section>
      )}

      <section class="mt-4 cta-with-kokusa">
        <img src={withImageBase('/images/common/kokusa/kokusa_bow.png')} alt="" class="cta-kokusa" />
        <div class="text-center">
          <a href={withBase('/policy/')} class="btn">政策を見る</a>
          <a href={withBase('/contact/')} class="btn btn-secondary" style="margin-left: 1rem;">お問い合わせ</a>
        </div>
      </section>
    </div>
  </div>
</main>

<style>
  /* プロフィールヘッダー */
  .profile-header {
    text-align: center;
    background: #f8fafc;
    border-radius: 8px;
    padding: 1rem;
  }

  .profile-header-content {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .profile-header-image-wrapper {
    width: 100%;
    margin: 0.5rem 0;
  }

  .profile-main-image {
    width: 100%;
    height: auto;
    display: block;
  }

  .profile-nickname,
  .profile-fullname {
    margin: 0;
    font-weight: 900;
    font-family: 'Noto Sans JP', "BIZ UDPGothic", "Hiragino Kaku Gothic Pro", "メイリオ", Meiryo, "ＭＳ Ｐゴシック", "MS PGothic", sans-serif;
  }

  .profile-nickname {
    font-size: 2rem;
    white-space: nowrap;
  }

  .profile-fullname {
    font-size: 3rem;
    border: none;
    padding: 0;
    color: #000000;
  }

  .profile-fullname rt {
    font-size: 0.4em;
    font-weight: normal;
    color: #000000;
  }

  .profile-district {
    font-size: 0.9375rem;
    margin: 0 0 0.75rem;
    line-height: 1.6;
  }

  .profile-cities {
    display: block;
    font-size: 0.875rem;
    margin-top: 0.25rem;
  }

  /* 共通リストスタイル */
  .profile-list {
    font-size: 18px;
    color: #000000;
  }

  /* 基本情報リスト */
  .profile-info-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .profile-info-item {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
  }

  .profile-info-label {
    font-weight: bold;
    color: #043e80;
  }

  .district-cities {
    font-size: 0.875rem;
    color: #000000;
  }

  /* 経歴・実績リスト */
  .history-list,
  .achievements-list {
    margin: 0;
    padding-left: 1.25rem;
  }

  .history-year {
    font-weight: bold;
    color: #043e80;
    margin-right: 0.5rem;
  }

  /* 政治信条 */
  .political-belief {
    background: #f8fafc;
    padding: 1.5rem;
    font-size: 18px;
    color: #000000;
    line-height: 1.8;
  }

  .political-belief p {
    margin: 0;
  }

  .political-belief-title {
    font-family: "Yuji Syuku", "Zen Kurenaido", "Klee One", serif;
    font-size: 1.5rem;
    font-weight: bold;
    color: #043e80;
    margin-bottom: 0.75rem !important;
    line-height: 1.4;
  }

  /* セクションタイトル */
  .section-title-with-kokusa {
    display: flex;
    align-items: flex-end;
    gap: 0.75rem;
    font-size: 1.5rem;
    color: #043e80;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #043e80;
  }

  /* こくさラッパー（下線を基準に画像の下部20%を切る） */
  .section-kokusa-wrapper {
    display: inline-flex;
    align-items: flex-start;
    flex-shrink: 0;
    height: 4.8rem;
    overflow: hidden;
    margin-bottom: -0.5rem;
  }

  .section-kokusa {
    height: 6rem;
    width: auto;
  }

  /* CTA */
  .cta-with-kokusa {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
    padding: 2rem;
    background: #f8fafc;
    border-radius: 8px;
  }

  .cta-kokusa {
    height: 80px;
    width: auto;
  }

  @media (max-width: 600px) {
    .section-kokusa-wrapper {
      height: 5.6rem;
    }

    .section-kokusa {
      height: 7rem;
    }

    .cta-kokusa {
      height: 60px;
    }
  }
</style>

<style is:global>
  /* 強調表示（アスタリスク囲み） */
  .emphasis {
    color: #c41e3a;
    font-weight: bold;
  }
</style>
