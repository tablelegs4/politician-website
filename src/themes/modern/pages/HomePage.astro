---
import { getCollection } from 'astro:content';
import { THEME_IMAGES, SITE_IMAGES } from '../../../config/theme';
import { getSiteConfig, getProfile } from '../../../utils/content';

// コンテンツ読み込み
const siteConfig = getSiteConfig();
const profile = getProfile();

// 最新活動報告4件を取得（activityがあればactivity、なければnewsを使用）
let latestActivities: any[] = [];
try {
  const allActivities = await getCollection('activity');
  latestActivities = allActivities
    .filter(entry => !entry.data.draft)
    .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
    .slice(0, 4);
} catch {
  const allNews = await getCollection('news');
  latestActivities = allNews
    .filter(entry => !entry.data.draft)
    .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
    .slice(0, 4);
}

// 日付フォーマット関数
const formatDate = (date: Date) => {
  return date.toLocaleDateString('ja-JP', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
};
---

<main class="modern-home">
  <!-- ヒーローセクション -->
  <section class="hero-section" style={`background-image: linear-gradient(135deg, rgba(4, 62, 128, 0.85) 0%, rgba(4, 62, 128, 0.7) 100%), url(${THEME_IMAGES.modern.hero})`}>
    <div class="container">
      <div class="hero-content">
        <h1 class="hero-title" set:html={siteConfig.hero.title.replace('、', '、<br>')}></h1>
        <p class="hero-subtitle">
          {siteConfig.hero.subtitle}
        </p>
        <div class="hero-actions">
          <a href="/policy/" class="btn-hero btn-primary">政策を見る</a>
          <a href={siteConfig.cta.primary.url} class="btn-hero btn-outline">{siteConfig.cta.primary.label}</a>
        </div>
      </div>
    </div>
  </section>

  <!-- メッセージセクション -->
  <section id="message" class="message-section">
    <div class="container">
      <div class="message-box">
        <p class="message-text">
          {siteConfig.greeting.message.split('\n\n')[0]}
        </p>
        <p class="message-signature">{profile.name}</p>
      </div>
    </div>
  </section>

  <!-- 活動報告セクション -->
  <section id="activity" class="news-section">
    <div class="container">
      <h2 class="section-title">最新の活動報告</h2>
      {latestActivities.length > 0 ? (
        <div class="news-grid">
          {latestActivities.map((entry) => (
            <article class="news-card">
              <a href={`/activity/${entry.id.replace('.md', '')}/`} class="news-card-link">
                <div class="news-card-date">{formatDate(entry.data.date)}</div>
                <h3 class="news-card-title">{entry.data.title}</h3>
                <p class="news-card-description">{entry.data.description}</p>
                <span class="news-card-arrow">→</span>
              </a>
            </article>
          ))}
        </div>
      ) : (
        <p class="no-news">現在、活動報告はありません。</p>
      )}
      <div class="text-center mt-4">
        <a href="/activity/" class="btn-more">すべての活動報告を見る</a>
      </div>
    </div>
  </section>

  <!-- 活動写真ギャラリー -->
  <section class="gallery-section">
    <div class="container">
      <h2 class="section-title">活動の様子</h2>
      <div class="gallery-grid">
        {SITE_IMAGES.activities.map((activity) => (
          <div class="gallery-item">
            <img
              src={activity.src}
              alt={activity.alt}
              class="gallery-image"
              loading="lazy"
            />
            <div class="gallery-overlay">
              <p class="gallery-caption">{activity.alt}</p>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- CTAセクション -->
  <section id="cta" class="cta-section">
    <div class="container">
      <div class="cta-grid">
        <div class="cta-card">
          <h3 class="cta-title">プロフィール</h3>
          <p class="cta-description">経歴や活動内容をご覧いただけます</p>
          <a href="/profile/" class="cta-link">詳しく見る</a>
        </div>
        <div class="cta-card">
          <h3 class="cta-title">政策</h3>
          <p class="cta-description">私が取り組む主要政策をご紹介します</p>
          <a href="/policy/" class="cta-link">詳しく見る</a>
        </div>
        <div class="cta-card">
          <h3 class="cta-title">お問い合わせ</h3>
          <p class="cta-description">ご意見・ご要望をお聞かせください</p>
          <a href="/contact/" class="cta-link">お問い合わせする</a>
        </div>
      </div>
    </div>
  </section>
</main>
