---
import Layout from '../../layouts/Layout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  const newsEntries = await getCollection('news');
  return newsEntries
    .filter(entry => !entry.data.draft)
    .map(entry => ({
      params: { slug: entry.id.replace('.md', '') },
      props: { entry },
    }));
}

interface Props {
  entry: CollectionEntry<'news'>;
}

const { entry } = Astro.props;
const { Content } = await entry.render();

// 日付フォーマット関数
const formatDate = (date: Date) => {
  return date.toLocaleDateString('ja-JP', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
  }).replace(/\//g, '-');
};

const formattedDate = formatDate(entry.data.date);
const isoDate = entry.data.date.toISOString().split('T')[0];
---

<Layout
  title={entry.data.title}
  description={entry.data.description}
  ogType="article"
>
  <main>
    <div class="container">
      <article>
        <header class="mb-3">
          <h1>{entry.data.title}</h1>
          <div class="card-meta">
            <time datetime={isoDate}>{formattedDate}</time>
            {entry.data.tags && entry.data.tags.length > 0 && (
              <span style="margin-left: 1rem;">
                {entry.data.tags.map(tag => `#${tag}`).join(' ')}
              </span>
            )}
          </div>
        </header>

        <div class="article-content">
          <Content />
        </div>

        <footer class="mt-4" style="padding-top: 2rem; border-top: 1px solid #e0e0e0;">
          <a href="/news/" class="btn">お知らせ一覧に戻る</a>
        </footer>
      </article>
    </div>
  </main>
</Layout>
